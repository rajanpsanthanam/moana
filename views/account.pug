extends sub-layout.pug

block pane
  -
    var ISOToDateFormat = function(dateString, limit){
      dateString=new Date(dateString).toLocaleString();
      dateString=dateString.split(',').slice(0, limit).join(' ');
      return dateString;
     }
  .row
    .col-md-10
      .row
        .col-md-1
          a(href='/accounts')
            i.fa.fa-backward
      h2 #{account.name}
      h4 managed by #{account.primary_manager.username}
      .row.text-center
        for feature in account.features
          if(feature.name.length > 20)
            - var featureName = feature.name.substring(0, 15)+'...'
          else
            - var featureName = feature.name
          .col-xs-6.col-sm-4.col-md-2
            button.btn.btn.btn-block.btn-xs(style="background-color:" + feature.bg_color + ";border-color:" + feature.bg_color + ";color:"+ feature.font_color) #{featureName}
    .col-md-2
      form(role='form', action='/accounts/manage/'+account.name+'/stages/', method="get")
        button.btn.btn-warning(type='submit') Manage Stage
  hr
  .row
    .col-sm-10
      .row
        .col-sm-3
          button.btn.btn-primary#stageButton(onclick="stageBarReport('" + account.name + "')") Days / Stage
      br
      .row
          canvas#myChart(style='width: 300px; height: 100px')
    .col-sm-2
      p.lead Important Dates
      .list-group
        .row
          p Signup Date
          if(account.signup_date)
            | #{ISOToDateFormat(account.signup_date, 1)}
          else
            | ~
          hr
          p Process Started On
          if(account.process_start_date)
            | #{ISOToDateFormat(account.process_start_date, 1)}
          else
            | ~
          hr
          p Expected Completion Date
          if(account.expected_completion_date)
            | #{ISOToDateFormat(account.expected_completion_date, 1)}
          else
            | ~
          hr
          p Actual Completion Date
          if(account.actual_completion_date)
            | #{ISOToDateFormat(account.actual_completion_date, 1)}
          else
            | ~
  br
  hr
  br
  .row
    .list-group
      .row
        form(role='form', action='/accounts/manage/'+account.name+'/add-comment', method="post")
          .row
            textarea.form-control(rows='3', name='comment')
          br
          .row.text-center
            button.btn.btn-warning(type='submit') add comment
      hr
      .row
        p.lead Timeline
        if(account.comments.length > 0)
          for comment in account.comments.reverse().slice(0, 20)
            if(comment.body.includes('New Stage:'))
              p.list-group-item-text
              span.label.label-info Stage Added
              |  #{comment.body.replace('New Stage:', '')}
            else if(comment.body.includes('Stage Completed:'))
              p.list-group-item-text
              span.label.label-success Stage Completed
              |  #{comment.body.replace('Stage Completed:', '')}
            else
              p.list-group-item-text #{comment.body}
            br
            p
            i  #{comment.by.username}
            |  @
            i  #{ISOToDateFormat(comment.date, 2)}
            hr
        else
          p No updates on the account yet
